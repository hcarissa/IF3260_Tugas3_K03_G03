<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Grafika Komputasional</title>
    <script>
        var isShading = false;
        var objectChosen = "cube";
        var oldValueMove = 0;
        var rotX = 0;
        var rotY = 0;
        var rotZ = 0;
        function changeObjectChosen(value){
          objectChosen = value
          console.log(objectChosen)
        }
    </script>
  </head>
  <body>
    <div class="row">
      <div><canvas id="canvas" width="770" height="770"></canvas></div>
      <div class="">

        <!-- Bentuk dan Proyeksi -->
        <div class="row">
          <div>
            <h2>Bentuk</h2>
            <div id="inputs-jenis-bentuk">
              <label for="bentuk">Jenis bentuk: </label>
              <input type="radio" name="bentuk" value="cube" checked onclick={changeObjectChosen(value)} />Kubus
              <input type="radio" name="bentuk" value="tetrahedral" onclick={changeObjectChosen(value)} />Tetrahedral
              <input type="radio" name="bentuk" value="prism" onclick={changeObjectChosen(value)} />Prisma
            </div>
          </div>

          <div>
            <h2>Proyeksi</h2>
            <div id="inputs-jenis-proyeksi">
              <label for="proyeksi">Jenis proyeksi: </label>
              <input
                type="radio"
                name="proyeksi"
                value="ortographic"
                onclick="orthoProjDraw()"
                checked
              />Orthographic
              <input type="radio" name="proyeksi" value="oblique" onclick="obliqueProjDraw()"/>Oblique
              <input type="radio" name="proyeksi" value="perspective" onclick="perspectiveProjDraw()" />Perspective
            </div>
          </div>
        </div>
        <hr>

        <h2>Rotasi, Translasi, Scaling</h2>
        <div id="input-rotasi">
          <h3>Rotasi</h3>
          <label for="rotateX">Rotasi X</label>
          <input
            type="range"
            id="rotateX"
            name="rotateX"
            min="-3.15"
            max="3.15"
            value="0"
            step="0.05"
            oninput="{this.nextElementSibling.value=this.value, rotateObjectX(value)}"
          />
          <output>0</output>
          <br/>
          <label for="rotateX">Rotasi Y</label>
          <input
            type="range"
            id="rotateY"
            name="rotateY"
            min="-3.15"
            max="3.15"
            value="0"
            step="0.05"
            oninput="{this.nextElementSibling.value=this.value, rotateObjectY(value)}"
          />
          <output>0</output>
          <br/>
          <label for="rotateX">Rotasi Z</label>
          <input
            type="range"
            id="rotateZ"
            name="rotateZ"
            min="-3.15"
            max="3.15"
            value="0"
            step="0.05" 
            oninput="{this.nextElementSibling.value=this.value,rotateObjectZ(value)}"
          />
          <output>0</output>
        </div>
        <div id="input-translasi">
          <h3>Translasi</h3>
          <button onclick="{translateObject('x', -0.1)}">←</button>
          <button onclick="{translateObject('x', 0.1)}">→</button>
          <button onclick="{translateObject('y', 0.1)}">↑</button>
          <button onclick="{translateObject('y', -0.1)}">↓</button>
        </div>
        <div id="input-scaling">
          <h3>Scaling</h3>
          <div class="input-scaling">
            <input type="number" id="scale" name="scale" min="0.1" step="0.1" value="1"/>
            <button id="button-scale" onclick="{updateScale(this.previousElementSibling.value)}">Scale</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div>
            <h2>Camera</h2>
            <div id="angle">
              <h3>Angle</h3>
              <div class="Angle">
                <label for="AngleX">Camera Angle X</label>
                <input
                  type="range"
                  id="angleX"
                  name="Horizontal View"
                  min="-360"
                  max="360"
                  step="1"
                  value="0"
                  oninput="{this.nextElementSibling.value=this.value, updateHView()}"
                />
                <output>0</output>
                <br/>                
                <label for="AngleY">Camera Angle Y</label>
                <input
                  type="range"
                  id="angleY"
                  name="Vertical View"
                  min="-360"
                  step="1"
                  max="360"
                  value="0"
                  oninput="{this.nextElementSibling.value=this.value, updateVView()}"
                />
                <output>0</output>
              </div>
            </div>
            <div class="input-radius" id="input-Radius">
              <h3>Zoom</h3>
              <button id="button-zoom" onmousedown="updateZoom(1.1)">In</button>
              <button id="button-zoom" onmousedown="updateZoom(0.9)">Out</button>
            </div>
          </div>
          <div>
            <h2>Shading</h2>
            <label for="shading">Shading: </label>
            <input class="shading" type="checkbox" id="shader" name="shading" onclick="updateShading()" />
          </div>
        </div>

        <hr>
        <div class="reset">
          <button id="resetButton" onclick="window.location.reload()">Reset</button>
          <button onclick="saveData()">Save</button>
          <button onclick="loadData()">Load</button>
        </div>
        <div id="dynamic-parent" hidden></div>
      </div>
    </div>
  </body>

  <script>
    var vertices = [];
    var objectsArray = [];

    const canvas = document.querySelector("#canvas");
    const gl = canvas.getContext("webgl");
    // Create a shader program object to store
    var shaderProgram = gl.createProgram();

    var vertCode = `
            attribute vec3 position;
            attribute vec3 normal;

            uniform mat4 Pmatrix;
            uniform mat4 Vmatrix;
            uniform mat4 Mmatrix;
            uniform mat4 Nmatrix;

            attribute vec3 color;
            varying vec3 vLighting;
            varying vec3 vColor;

            void main(void) {
                gl_Position = Pmatrix*Vmatrix*Mmatrix*vec4(position, 1.);
                vec3 ambientLight = vec3(0.3, 0.3, 0.3);
                vec3 directionalLightColor = vec3(1, 1, 1);
                vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));
                vec4 transformedNormal = Nmatrix*vec4(normal, 1.);
                
                float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);
                vLighting = ambientLight + (directionalLightColor * directional);
                vColor = color;
            }
            `;

    // Create a vertex shader object
    var vertShader = gl.createShader(gl.VERTEX_SHADER);

    // Fragment shader source code
    var fragCode =
      "precision mediump float;" +
      "varying vec3 vColor;" +
      "varying vec3 vLighting;" +
      "void main(void) {" +
      "gl_FragColor = vec4(vColor, 1.);" +
      "gl_FragColor.rgb *= vLighting;" +
      "}";

    // Create fragment shader object
    var fragShader = gl.createShader(gl.FRAGMENT_SHADER);

    // Create a shader program object to store
    // var shaderProgram = gl.createProgram();

    function setupShader() {
      // Attach vertex shader source code
      gl.shaderSource(vertShader, vertCode);
      // Compile the vertex shader
      gl.compileShader(vertShader);
      // Attach fragment shader source code
      gl.shaderSource(fragShader, fragCode);
      // Compile the fragment shader
      gl.compileShader(fragShader);
    }

    function setupProgram() {
      // Attach a vertex shader
      gl.attachShader(shaderProgram, vertShader);
      // Attach a fragment shader
      gl.attachShader(shaderProgram, fragShader);
      // Link both the programs
      gl.linkProgram(shaderProgram);
    }

    setupShader();
    setupProgram();
  </script>
  <!-- <script type="text/javascript" src="script.js"></script> -->
  <script type="text/javascript" src="objectInit.js"></script>
  <script type="text/javascript" src="draw.js"></script>
  <script type="text/javascript" src="translate.js"></script>
  <script type="text/javascript" src="rotate.js"></script>
  <script type="text/javascript" src="scale.js"></script>
  <script type="text/javascript" src="utils.js"></script>
  <script type="text/javascript" src="camera.js"></script>
  <script type="text/javascript" src="projection.js"></script>
  <script>
    document.getElementById('AngleX').oninput = oldValueMove;
  </script>
</html>
